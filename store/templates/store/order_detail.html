{% extends 'base.html' %}
{% load static %}

{% block title %}Détails de Commande - YEE Store{% endblock %}

{% block extra_css %}
<style>
.order-detail-rhode {
    background: var(--rhode-neutral-light, #FAF9F6);
    min-height: 100vh;
    padding: 2rem 0;
}

.breadcrumb-rhode {
    background: transparent;
    padding: 0;
    margin: 0 0 2rem 0;
}

.breadcrumb-rhode .breadcrumb-item a {
    color: var(--rhode-gray-medium, #8E8E8E);
    text-decoration: none;
    font-size: 0.875rem;
}

.breadcrumb-rhode .breadcrumb-item.active {
    color: var(--rhode-black, #000);
    font-weight: var(--font-weight-medium, 500);
}

.order-header-rhode {
    background: var(--rhode-white, #fff);
    border-radius: var(--border-radius-xl, 16px);
    box-shadow: var(--rhode-shadow, 0 4px 20px rgba(0, 0, 0, 0.1));
    padding: 2rem;
    margin-bottom: 2rem;
}

.order-title-rhode {
    font-family: var(--font-primary, Inter, sans-serif);
    font-weight: var(--font-weight-bold, 700);
    color: var(--rhode-black, #000);
    font-size: 2rem;
    margin-bottom: 0.5rem;
}

.order-subtitle-rhode {
    color: var(--rhode-gray-medium, #8E8E8E);
    font-size: 1rem;
    margin-bottom: 1rem;
}

.payment-success-badge-rhode {
background: linear-gradient(135deg, #000, #222);
    color: white;
    padding: 0.75rem 1.5rem;
    border-radius: var(--border-radius-lg, 12px);
    border: none;
    font-weight: var(--font-weight-medium, 500);
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 1rem;
}

.order-card-rhode {
    background: var(--rhode-white, #fff);
    border-radius: var(--border-radius-xl, 16px);
    box-shadow: var(--rhode-shadow, 0 4px 20px rgba(0, 0, 0, 0.1));
    padding: 2rem;
    margin-bottom: 2rem;
}

.order-section-title-rhode {
    font-family: var(--font-primary, Inter, sans-serif);
    font-weight: var(--font-weight-semibold, 600);
    color: var(--rhode-black, #000);
    font-size: 1.25rem;
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--rhode-border, #E8E8E8);
}

.info-item-rhode {
    margin-bottom: 1.5rem;
}

.info-label-rhode {
    color: var(--rhode-gray-medium, #8E8E8E);
    font-size: 0.875rem;
    font-weight: var(--font-weight-medium, 500);
    margin-bottom: 0.25rem;
}

.info-value-rhode {
    color: var(--rhode-black, #000);
    font-weight: var(--font-weight-semibold, 600);
    font-size: 1rem;
}

.status-badge-rhode {
    padding: 0.5rem 1rem;
    border-radius: var(--border-radius-md, 8px);
    font-size: 0.875rem;
    font-weight: var(--font-weight-medium, 500);
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.status-success-rhode {
    background: rgba(34, 197, 94, 0.1);
    color: #16a34a;
}

.status-warning-rhode {
    background: rgba(245, 158, 11, 0.1);
    color: #d97706;
}

.product-item-rhode {
    display: flex;
    align-items: center;
    padding: 1.5rem;
    background: var(--rhode-cream, #F8F6F3);
    border-radius: var(--border-radius-lg, 12px);
    margin-bottom: 1rem;
}

.product-image-rhode {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: var(--border-radius-md, 8px);
    margin-right: 1.5rem;
    flex-shrink: 0;
}

.product-details-rhode {
    flex: 1;
}

.product-name-rhode {
    font-weight: var(--font-weight-semibold, 600);
    color: var(--rhode-black, #000);
    font-size: 1.125rem;
    margin-bottom: 0.5rem;
}

.product-meta-rhode {
    color: var(--rhode-gray-medium, #8E8E8E);
    font-size: 0.875rem;
    margin-bottom: 0.25rem;
}

.product-price-rhode {
    font-weight: var(--font-weight-bold, 700);
    color: var(--rhode-black, #000);
    font-size: 1.25rem;
}

.btn-rhode {
    background: var(--rhode-black, #000);
    color: var(--rhode-white, #fff);
    border: none;
    padding: 0.75rem 2rem;
    border-radius: var(--border-radius-md, 8px);
    font-weight: var(--font-weight-medium, 500);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    cursor: pointer;
}

.btn-rhode:hover {
    background: var(--rhode-gray-dark, #2D2D2D);
    color: var(--rhode-white, #fff);
    transform: translateY(-2px);
    box-shadow: var(--rhode-shadow-hover, 0 8px 30px rgba(0, 0, 0, 0.15));
}

.btn-rhode-outline {
    background: transparent;
    color: var(--rhode-black, #000);
    border: 1px solid var(--rhode-border, #E8E8E8);
    padding: 0.75rem 2rem;
    border-radius: var(--border-radius-md, 8px);
    font-weight: var(--font-weight-medium, 500);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    cursor: pointer;
}

.btn-rhode-outline:hover {
    background: var(--rhode-black, #000);
    color: var(--rhode-white, #fff);
    border-color: var(--rhode-black, #000);
}

.btn-rhode-danger {
    background: transparent;
    color: #dc3545;
    border: 1px solid #dc3545;
    padding: 0.75rem 2rem;
    border-radius: var(--border-radius-md, 8px);
    font-weight: var(--font-weight-medium, 500);
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    transition: all 0.3s ease;
    cursor: pointer;
}

.btn-rhode-danger:hover {
    background: #dc3545;
    color: white;
    border-color: #dc3545;
}

.total-amount-rhode {
    font-size: 1.5rem;
    font-weight: var(--font-weight-bold, 700);
    color: var(--rhode-black, #000);
}

.sidebar-card-rhode {
    background: var(--rhode-white, #fff);
    border-radius: var(--border-radius-xl, 16px);
    box-shadow: var(--rhode-shadow, 0 4px 20px rgba(0, 0, 0, 0.1));
    padding: 2rem;
    position: sticky;
    top: 2rem;
}

@media (max-width: 768px) {
    .order-header-rhode .d-flex {
        flex-direction: column;
        gap: 1rem;
    }

    .btn-rhode, .btn-rhode-outline {
        width: 100%;
        justify-content: center;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="order-detail-rhode">
    <div class="container">
        <!-- Breadcrumb -->
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb breadcrumb-rhode">
                <li class="breadcrumb-item"><a href="{% url 'index' %}">Accueil</a></li>
                <li class="breadcrumb-item"><a href="{% url 'accounts:profile' %}">Mon Profil</a></li>
                <li class="breadcrumb-item"><a href="{% url 'store:order_history' %}">Mes Commandes</a></li>
                <li class="breadcrumb-item active" aria-current="page">Commande #{{ order.id }}</li>
            </ol>
        </nav>

        <!-- En-tête de la commande -->
        <div class="order-header-rhode">
            <div class="d-flex justify-content-between align-items-start flex-wrap gap-3">
                <div>
                    <h1 class="order-title-rhode">Détails de la Commande</h1>
                    <p class="order-subtitle-rhode">Commande #{{ order.id }} passée le {{ order.date_ordered|date:"d F Y à H:i" }}</p>
                    {% if payment_success %}
                    <div class="payment-success-badge-rhode">
                        <i class="bi bi-check-circle-fill"></i>
                        <strong>Paiement confirmé !</strong> Votre commande a été traitée avec succès.
                    </div>
                    {% endif %}
                </div>
                <div class="d-flex gap-2 flex-wrap">
                    <a href="{% url 'store:download_invoice' order.id %}" class="btn-rhode-outline">
                        <i class="bi bi-download"></i>Télécharger la Facture
                    </a>
                    <a href="{% url 'store:reorder' order.id %}" class="btn-rhode">
                        <i class="bi bi-arrow-repeat"></i>Recommander
                    </a>
                </div>
            </div>
        </div>

        <div class="row">
            <!-- Contenu principal -->
            <div class="col-lg-8">
                <!-- Informations de la commande -->
                <div class="order-card-rhode">
                    <h2 class="order-section-title-rhode">Informations de la Commande</h2>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-item-rhode">
                                <div class="info-label-rhode">Numéro de Commande</div>
                                <div class="info-value-rhode">{{ order.id|stringformat:"03d" }}-{{ order.id|add:5840 }}-{{ order.id|add:960 }}-{{ order.id|add:7000|stringformat:"04d" }}</div>
                            </div>
                            <div class="info-item-rhode">
                                <div class="info-label-rhode">Date de Commande</div>
                                <div class="info-value-rhode">{{ order.date_ordered|date:"d F Y" }}</div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="info-item-rhode">
                                <div class="info-label-rhode">Statut de la Commande</div>
                                <div>
                                    {% if order.ordered %}
                                        <span class="status-badge-rhode status-success-rhode">
                                            <i class="bi bi-check-circle-fill"></i>
                                            {{ order_status|default:"Payé" }}
                                        </span>
                                        {% if payment_success %}
                                            <small class="d-block mt-1" style="color: #16a34a;">
                                                <i class="bi bi-lightning-fill"></i> Paiement confirmé à l'instant
                                            </small>
                                        {% endif %}
                                    {% else %}
                                        <span class="status-badge-rhode status-warning-rhode">
                                            <i class="bi bi-clock-fill"></i>
                                            En attente de paiement
                                        </span>
                                    {% endif %}
                                </div>
                            </div>
                            <div class="info-item-rhode">
                                <div class="info-label-rhode">Montant Total</div>
                                <div class="total-amount-rhode">{{ order.total_price|floatformat:2 }} €</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Détails du produit -->
                <div class="order-card-rhode">
                    <h2 class="order-section-title-rhode">Détails du Produit</h2>

                    <div class="product-item-rhode">
                        <div>
                            {% if order.product.thumbnail %}
                                <img src="{{ order.product.thumbnail.url }}" alt="{{ order.product.title }}" class="product-image-rhode">
                            {% else %}
                                <div class="product-image-rhode" style="background: var(--rhode-gray-light, #F5F5F5); display: flex; align-items: center; justify-content: center;">
                                    <i class="bi bi-image" style="font-size: 2rem; color: var(--rhode-gray-medium, #8E8E8E);"></i>
                                </div>
                            {% endif %}
                        </div>
                        <div class="product-details-rhode">
                            <h3 class="product-name-rhode">{{ order.product.title }}</h3>
                            <div class="product-meta-rhode">Quantité: {{ order.quantity }}</div>
                            {% if order.size %}
                                <div class="product-meta-rhode">Taille: {{ order.size }}</div>
                            {% endif %}
                            {% if order.color %}
                                <div class="product-meta-rhode">Couleur: {{ order.color }}</div>
                            {% endif %}
                            <div class="product-price-rhode">{{ order.product.price|floatformat:2 }} € × {{ order.quantity }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sidebar -->
            <div class="col-lg-4">
                <div class="sidebar-card-rhode">
                    <h3 class="order-section-title-rhode">Résumé de la Commande</h3>

                    <div class="d-flex justify-content-between mb-2">
                        <span>Sous-total:</span>
                        <span>{{ order.product.price|floatformat:2 }} €</span>
                    </div>
                    <div class="d-flex justify-content-between mb-2">
                        <span>Quantité:</span>
                        <span>{{ order.quantity }}</span>
                    </div>
                    <div class="d-flex justify-content-between mb-3">
                        <span>Livraison:</span>
                        <span>Gratuite</span>
                    </div>
                    <hr style="border-color: var(--rhode-border, #E8E8E8);">
                    <div class="d-flex justify-content-between">
                        <strong>Total:</strong>
                        <strong class="total-amount-rhode">{{ order.total_price|floatformat:2 }} €</strong>
                    </div>

                    <div class="mt-4">
                        <a href="{% url 'store:download_invoice' order.id %}" class="btn-rhode-outline w-100 mb-2 justify-content-center">
                            <i class="bi bi-download"></i>Télécharger la Facture
                        </a>
                        <a href="{% url 'store:reorder' order.id %}" class="btn-rhode w-100 mb-2 justify-content-center">
                            <i class="bi bi-arrow-repeat"></i>Recommander
                        </a>
                        <form method="post" action="{% url 'store:cancel_order' order.id %}" class="d-inline w-100">
                            {% csrf_token %}
                            <button type="submit" class="btn-rhode-danger w-100 justify-content-center"
                                    onclick="return confirm('Êtes-vous sûr de vouloir annuler cette commande?')">
                                <i class="bi bi-x-circle"></i>Annuler la Commande
                            </button>
                        </form>
                    </div>
                </div>

                <div class="sidebar-card-rhode mt-3">
                    <h3 class="order-section-title-rhode">Navigation</h3>
                    <a href="{% url 'store:order_history' %}" class="btn-rhode-outline w-100 justify-content-center">
                        <i class="bi bi-arrow-left"></i>Retour aux Commandes
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
