{% extends 'base.html' %}
{% load static %}

{% block title %}R√©initialisation de mot de passe - YEE Codes{% endblock %}

{% block content %}
<div class="container mt-5">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h4 class="mb-0">üîë R√©initialisation de mot de passe</h4>
                </div>
                <div class="card-body">
                    {% if valid_link %}
                        <!-- Lien valide - afficher le formulaire -->
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i>
                            Veuillez saisir votre nouveau mot de passe ci-dessous.
                        </div>

                        <form method="post">
                            {% csrf_token %}

                            <div class="mb-3">
                                <label for="new_password" class="form-label">
                                    <i class="fas fa-lock"></i> Nouveau mot de passe
                                </label>
                                <input type="password"
                                       class="form-control"
                                       id="new_password"
                                       name="new_password"
                                       required
                                       placeholder="Saisissez votre nouveau mot de passe">
                                <div class="form-text">
                                    Le mot de passe doit contenir au moins 8 caract√®res.
                                </div>
                            </div>

                            <div class="mb-3">
                                <label for="confirm_password" class="form-label">
                                    <i class="fas fa-lock"></i> Confirmer le mot de passe
                                </label>
                                <input type="password"
                                       class="form-control"
                                       id="confirm_password"
                                       name="confirm_password"
                                       required
                                       placeholder="Confirmez votre nouveau mot de passe">
                            </div>

                            <div class="d-grid">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fas fa-save"></i> D√©finir le nouveau mot de passe
                                </button>
                            </div>
                        </form>

                        <div class="alert alert-warning mt-3">
                            <h6><i class="fas fa-exclamation-triangle"></i> Important :</h6>
                            <ul class="mb-0">
                                <li>Ce lien ne peut √™tre utilis√© qu'<strong>une seule fois</strong></li>
                                <li>Il expire apr√®s <strong>3 jours</strong></li>
                                <li>Votre nouveau mot de passe doit respecter les r√®gles de s√©curit√©</li>
                            </ul>
                        </div>

                    {% else %}
                        <!-- Lien invalide ou expir√© -->
                        <div class="alert alert-danger">
                            <h5><i class="fas fa-times-circle"></i> Lien invalide ou expir√©</h5>
                            <p>Ce lien de r√©initialisation n'est plus valide. Cela peut arriver si :</p>
                            <ul>
                                <li>Le lien a d√©j√† √©t√© utilis√©</li>
                                <li>Le lien a expir√© (plus de 3 jours)</li>
                                <li>Le lien est malform√©</li>
                            </ul>
                        </div>

                        <div class="text-center">
                            <p>Vous pouvez demander un nouveau lien de r√©initialisation :</p>
                            <a href="{% url 'accounts:password_reset_request' %}" class="btn btn-primary">
                                <i class="fas fa-redo"></i> Nouvelle demande de r√©initialisation
                            </a>
                        </div>
                    {% endif %}

                    <hr class="my-4">

                    <div class="text-center">
                        <a href="{% url 'accounts:login' %}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left"></i> Retour √† la connexion
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Validation c√¥t√© client -->
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.querySelector('form');
    const newPassword = document.getElementById('new_password');
    const confirmPassword = document.getElementById('confirm_password');

    if (form) {
        form.addEventListener('submit', function(e) {
            if (newPassword.value !== confirmPassword.value) {
                e.preventDefault();
                alert('Les mots de passe ne correspondent pas !');
                confirmPassword.focus();
                return false;
            }

            if (newPassword.value.length < 8) {
                e.preventDefault();
                alert('Le mot de passe doit contenir au moins 8 caract√®res !');
                newPassword.focus();
                return false;
            }
        });

        // Validation en temps r√©el
        confirmPassword.addEventListener('input', function() {
            if (this.value && this.value !== newPassword.value) {
                this.setCustomValidity('Les mots de passe ne correspondent pas');
            } else {
                this.setCustomValidity('');
            }
        });
    }
});
</script>
{% endblock %}
